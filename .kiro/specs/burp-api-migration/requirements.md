# 需求文档

## 介绍

OneScan 插件需要从传统的 Burp Extender API 直接迁移到现代的 Montoya API，以提高兼容性和可维护性。迁移采用简单直接的替换方法，删除所有传统 API 调用，直接使用 Montoya API。

## 术语表

- **传统 API**: 基于 IBurpExtender 的旧版 Burp Suite 扩展 API
- **Montoya API**: Burp Suite 的现代扩展 API  
- **OneScan**: 智能递归目录扫描 Burp Suite 插件
- **行为等价性**: 迁移前后功能结果一致，用户无感知
- **直接替换**: 删除传统 API 调用，直接使用 Montoya API
- **用户空间**: 用户配置文件、UI 界面、扫描结果等用户可见部分

## 需求

### 需求 1

**用户故事:** 作为 OneScan 插件的用户，我希望插件能够在新版本的 Burp Suite 中正常运行，以便继续使用所有现有功能。

#### 验收标准

1. 当插件迁移到 Montoya API 后，OneScan 系统应当保持所有现有功能行为等价
2. 当用户执行递归目录扫描时，OneScan 系统应当产生相同的扫描结果
3. 当用户使用指纹识别功能时，OneScan 系统应当识别出相同的指纹类型和数量
4. 当用户配置扫描参数时，OneScan 系统应当支持所有原有的配置选项
5. 当用户查看扫描历史时，OneScan 系统应当显示一致的数据格式

### 需求 2

**用户故事:** 作为开发人员，我希望迁移过程简单直接，以便能够快速完成并验证功能正确性。

#### 验收标准

1. 当执行迁移时，OneScan 系统应当直接替换所有传统 API 调用为 Montoya API
2. 当编译代码时，OneScan 系统应当通过编译器检查找出所有需要修改的地方
3. 当发现问题时，OneScan 系统应当通过 Git 版本控制快速回滚
4. 当迁移完成时，OneScan 系统应当完全移除传统 API 依赖
5. 当测试验证时，OneScan 系统应当通过核心功能测试确保正确性

### 需求 3

**用户故事:** 作为系统管理员，我希望迁移后的插件性能更好且更稳定。

#### 验收标准

1. 当迁移完成后，OneScan 系统应当消除双重数据拷贝，提升性能
2. 当处理扫描任务时，OneScan 系统应当利用 Montoya API 的现代特性
3. 当系统长期运行时，OneScan 系统应当受益于 Montoya API 的内置线程安全
4. 当处理字符编码时，OneScan 系统应当利用 Montoya API 的原生 UTF-8 支持
5. 当发生异常情况时，OneScan 系统应当直接抛出清晰的异常信息

### 需求 4

**用户故事:** 作为质量保证工程师，我希望迁移过程有充分的测试覆盖，以便确保功能正确性和向后兼容。

#### 验收标准

1. 当执行单元测试时，OneScan 系统应当测试核心业务逻辑而非 API 调用
2. 当执行集成测试时，OneScan 系统应当验证 Montoya API 集成的正确性
3. 当执行回归测试时，OneScan 系统应当对比迁移前后相同输入产生相同输出
4. 当执行端到端测试时，OneScan 系统应当覆盖关键用户场景（扫描、指纹识别、数据收集）
5. 当执行性能测试时，OneScan 系统应当验证性能提升或至少不回退
6. 当测试字符编码时，OneScan 系统应当正确处理中文 URL、Header、Body
7. 当测试错误恢复时，OneScan 系统应当保持网络超时等可恢复错误的优雅降级行为

### 需求 5

**用户故事:** 作为 OneScan 插件的用户，我希望迁移完全不影响我的使用体验。

#### 验收标准

1. 当迁移完成后，OneScan 系统应当保持所有界面功能和交互完全一致
2. 当用户操作界面元素时，OneScan 系统应当提供相同的响应和反馈
3. 当显示扫描结果时，OneScan 系统应当保持相同的数据格式和显示方式
4. 当用户使用现有配置时，OneScan 系统应当完全兼容无需修改
5. 当用户升级插件时，OneScan 系统应当无缝切换无需额外操作

### 需求 6

**用户故事:** 作为项目维护者，我希望迁移后的代码更简洁易维护，以便降低未来的开发成本。

#### 验收标准

1. 当迁移完成后，OneScan 系统应当完全移除传统 API 代码和依赖
2. 当添加新功能时，OneScan 系统应当直接使用 Montoya API 无需适配层
3. 当进行代码审查时，OneScan 系统应当具有清晰简洁的代码结构
4. 当新人学习代码时，OneScan 系统应当易于理解无复杂抽象层
5. 当进行重构时，OneScan 系统应当具有直接的 API 调用关系

### 需求 7

**用户故事:** 作为 OneScan 插件的用户，我希望升级到新版本后能无缝使用旧版本的配置和数据，以便保持工作连续性。

#### 验收标准

1. 当加载 v2.2.0 创建的配置文件时，OneScan 系统应当成功解析或自动升级格式
2. 当导入 v2.2.0 的扫描结果时，OneScan 系统应当正确显示或提供清晰的不兼容提示
3. 当使用 v2.2.0 的指纹规则库时，OneScan 系统应当保持匹配行为一致
4. 当持久化数据格式改变时，OneScan 系统应当提供迁移工具或向后兼容读取
5. 当需要降级回 v2.2.0 时，OneScan 系统应当能读取 v2.3.0 写入的配置（或明确提示不兼容）

### 需求 8

**用户故事:** 作为开发人员，我希望迁移后的错误处理保持现有的容错能力，以便扫描任务不会因单个请求失败而崩溃。

#### 验收标准

1. 当发生网络超时时，OneScan 系统应当标记超时主机并继续处理其他 URL
2. 当 HTTP 请求失败时，OneScan 系统应当记录错误并跳过该 Payload
3. 当正则匹配失败时，OneScan 系统应当跳过该指纹规则并继续其他规则
4. 当配置文件损坏时，OneScan 系统应当使用默认配置并提示用户
5. 当线程池异常时，OneScan 系统应当优雅关闭并保存已完成的扫描结果