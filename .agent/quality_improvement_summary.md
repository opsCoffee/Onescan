# OneScan ä»£ç å®¡æŸ¥æ‰§è¡Œæ‘˜è¦

**æ‰§è¡Œæ—¥æœŸ**ï¼š2025-12-02
**é¡¹ç›®**ï¼šOneScan BurpSuite Extension
**ä»£ç è§„æ¨¡**ï¼š87ä¸ªJavaæ–‡ä»¶ï¼Œ16,696è¡Œä»£ç 
**å®¡æŸ¥æ–¹æ³•**ï¼šLinus Torvalds é£æ ¼å…¨é¢æŠ€æœ¯å®¡æŸ¥

---

## ğŸ“Š å®¡æŸ¥ç»“æœæ¦‚è§ˆ

### å‘ç°çš„é—®é¢˜

| ä¼˜å…ˆçº§ | æ•°é‡ | å…³é”®é—®é¢˜ |
|--------|------|----------|
| ğŸ”´ CRITICAL | 11 | QPSé™åˆ¶å™¨æŒæœ‰é”sleepã€æ•°ç»„è¶Šç•Œã€ç›‘å¬å™¨ç«æ€ |
| ğŸŸ¡ HIGH | 17 | ReDoSæ”»å‡»ã€ä¸å®‰å…¨ååºåˆ—åŒ–ã€å¼‚å¸¸åæ²¡ |
| ğŸŸ  MEDIUM | 20 | æ— ç•Œé›†åˆã€åµŒå¥—å¹¶è¡Œæµã€æ¥å£è¿‡åº¦æŠ½è±¡ |
| ğŸŸ¢ LOW | 11 | ä»£ç é£æ ¼ã€æ–‡æ¡£ç¼ºå¤±ã€é­”æ³•æ•°å­— |
| **æ€»è®¡** | **59** | - |

### ä»£ç è´¨é‡è¯„åˆ†

- **æ•´ä½“è´¨é‡**ï¼šâ­â­â­â˜†â˜† (3/5)
- **å®‰å…¨æ€§**ï¼šâ­â­â˜†â˜†â˜† (2/5)
- **å¹¶å‘å®‰å…¨**ï¼šâ­â­â˜†â˜†â˜† (2/5)
- **æ€§èƒ½**ï¼šâ­â­â­â­â˜† (4/5)
- **å¯ç»´æŠ¤æ€§**ï¼šâ­â­â­â˜†â˜† (3/5)

---

## ğŸ”¥ å…³é”®å‘ç°ï¼ˆTop 5ï¼‰

### 1. ğŸ”´ QPSé™åˆ¶å™¨ç¾éš¾æ€§è®¾è®¡ç¼ºé™·

**æ–‡ä»¶**ï¼š`src/main/java/burp/common/helper/QpsLimiter.java:55-78`

**é—®é¢˜**ï¼šsynchronizedæ–¹æ³•å†…è°ƒç”¨Thread.sleep()ï¼ŒæŒæœ‰é”æœŸé—´é˜»å¡æ‰€æœ‰ç­‰å¾…çº¿ç¨‹

**å½±å“**ï¼š
- 50ä¸ªæ‰«æçº¿ç¨‹ä¸²è¡ŒåŒ–ï¼Œå®é™…å¹¶å‘é™ä¸º1
- æ€§èƒ½æŸå¤±ï¼š50å€
- ç”¨æˆ·ä½“éªŒï¼šBurpSuiteä¸¥é‡å¡é¡¿

**ä¿®å¤ä¼˜å…ˆçº§**ï¼šP0 - ç«‹å³ä¿®å¤
**ä¿®å¤æ—¶é—´**ï¼š30åˆ†é’Ÿ

---

### 2. ğŸ”´ ReDoSæ­£åˆ™è¡¨è¾¾å¼æ‹’ç»æœåŠ¡

**æ–‡ä»¶**ï¼š
- `src/main/java/burp/onescan/ui/widget/payloadlist/rule/MatchReplace.java:59`
- `src/main/java/burp/onescan/common/FpMethodHandler.java:134`

**é—®é¢˜**ï¼šç”¨æˆ·å¯æ§æ­£åˆ™è¡¨è¾¾å¼æ— è¶…æ—¶ä¿æŠ¤ï¼Œæ¶æ„æ¨¡å¼å¯å¯¼è‡´æŒ‡æ•°çº§å›æº¯

**æ”»å‡»ç¤ºä¾‹**ï¼š
```yaml
regex: "(a+)+"
input: "aaaaaaaaaaaaaaac"
ç»“æœï¼šCPU 100%ï¼ŒBurpSuiteå®Œå…¨æŒ‚èµ·
```

**ä¿®å¤ä¼˜å…ˆçº§**ï¼šP0 - ç«‹å³ä¿®å¤
**ä¿®å¤æ—¶é—´**ï¼š2å°æ—¶

---

### 3. ğŸ”´ æ•°ç»„/å­—ç¬¦ä¸²è¶Šç•Œå´©æºƒé£é™©

**æ–‡ä»¶**ï¼š
- `src/main/java/burp/common/helper/DomainHelper.java:90`
- `src/main/java/burp/BurpExtender.java:512`
- `src/main/java/burp/common/utils/UrlUtils.java:227,244,264`

**é—®é¢˜**ï¼šsplit()ã€substring()æ“ä½œæœªéªŒè¯è¾¹ç•Œæ¡ä»¶

**å´©æºƒåœºæ™¯**ï¼š
```java
getSubDomain("");  // ArrayIndexOutOfBoundsException
matchHost(host, "**");  // æœŸæœ›2ä¸ªå…ƒç´ ï¼Œå®é™…3ä¸ª
path.substring(0, path.length() - 2);  // pathåªæœ‰1ä¸ªå­—ç¬¦æ—¶å´©æºƒ
```

**ä¿®å¤ä¼˜å…ˆçº§**ï¼šP0 - ç«‹å³ä¿®å¤
**ä¿®å¤æ—¶é—´**ï¼š1å°æ—¶

---

### 4. ğŸŸ  æ— ç•Œé›†åˆå¯¼è‡´å†…å­˜æ³„æ¼

**æ–‡ä»¶**ï¼š
- `src/main/java/burp/BurpExtender.java:112` (sTimeoutReqHost)
- `src/main/java/burp/onescan/manager/FpManager.java:50-51` (sFpCache, sFpHistory)

**é—®é¢˜**ï¼šä¸‰ä¸ªå…³é”®é›†åˆæ— å¤§å°é™åˆ¶ï¼Œé•¿æ—¶é—´è¿è¡Œå¿…ç„¶OOM

**å†…å­˜ä¼°ç®—**ï¼š
- æ‰«æ100ä¸‡URL â†’ 2GBç¼“å­˜å†…å­˜
- 10ä¸‡ä¸ªè¶…æ—¶ä¸»æœº â†’ 2MBå†…å­˜

**ä¿®å¤ä¼˜å…ˆçº§**ï¼šP1 - é«˜ä¼˜å…ˆçº§
**ä¿®å¤æ—¶é—´**ï¼š1.5å°æ—¶

---

### 5. ğŸŸ¡ VLayout/HLayout 95%ä»£ç é‡å¤

**æ–‡ä»¶**ï¼š
- `src/main/java/burp/common/layout/VLayout.java` (138è¡Œ)
- `src/main/java/burp/common/layout/HLayout.java` (139è¡Œ)

**é—®é¢˜**ï¼šçº¯ç²¹çš„å¤åˆ¶ç²˜è´´ï¼Œè¿åDRYåŸåˆ™ï¼Œæ˜¯**åå“å‘³**çš„å…¸å‹

**Linusè¯„ä»·**ï¼š
> "è¿™æ˜¯åƒåœ¾ã€‚å¦‚æœä½ éœ€è¦ä¸¤ä¸ªå‡ ä¹ä¸€æ ·çš„ç±»ï¼Œé‚£ä¹ˆä½ çš„æ•°æ®ç»“æ„å°±é”™äº†ã€‚"

**ä¿®å¤ä¼˜å…ˆçº§**ï¼šP2 - ä»£ç è´¨é‡æ”¹è¿›
**ä¿®å¤æ—¶é—´**ï¼š2å°æ—¶
**æ”¶ç›Š**ï¼šåˆ é™¤277è¡Œé‡å¤ä»£ç 

---

## ğŸ“‹ ä¿®å¤è·¯çº¿å›¾

### Phase 1ï¼šç´§æ€¥ä¿®å¤ï¼ˆ1-3å¤©ï¼‰ğŸ”´

**å¿…é¡»ç«‹å³å®Œæˆï¼Œå¦åˆ™ç”Ÿäº§ç¯å¢ƒé•¿æ—¶é—´è¿è¡Œå¿…ç„¶å‡ºé—®é¢˜**

- [ ] ä¿®å¤QPSé™åˆ¶å™¨ï¼ˆ30åˆ†é’Ÿï¼‰â†’ æ€§èƒ½æå‡50å€
- [ ] ä¿®å¤æ•°ç»„è¶Šç•Œï¼ˆ1å°æ—¶ï¼‰â†’ æ¶ˆé™¤å´©æºƒé£é™©
- [ ] ä¿®å¤ç›‘å¬å™¨ç«æ€ï¼ˆ10åˆ†é’Ÿï¼‰â†’ æ¶ˆé™¤ConcurrentModificationException
- [ ] æ·»åŠ ReDoSä¿æŠ¤ï¼ˆ2å°æ—¶ï¼‰â†’ é˜²æ­¢BurpSuiteæŒ‚èµ·

**æ€»è®¡**ï¼š3å°æ—¶40åˆ†é’Ÿ
**å½±å“**ï¼šæ¶ˆé™¤4ä¸ªCRITICALçº§åˆ«ç¼ºé™·

---

### Phase 2ï¼šé‡è¦ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰ğŸŸ¡

- [ ] å®ç°æœ‰ç•Œè¶…æ—¶ä¸»æœºé›†åˆï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] å®ç°æœ‰ç•ŒæŒ‡çº¹ç¼“å­˜ï¼ˆ1å°æ—¶ï¼‰
- [ ] ä¿®å¤ä¸å®‰å…¨ååºåˆ—åŒ–ï¼ˆ1å°æ—¶ï¼‰
- [ ] ä¼˜åŒ–Repeat Filterï¼ˆ5åˆ†é’Ÿï¼‰
- [ ] ä¿®å¤å¼‚å¸¸åæ²¡ï¼ˆ3å°æ—¶ï¼‰

**æ€»è®¡**ï¼š5å°æ—¶35åˆ†é’Ÿ
**å½±å“**ï¼šæå‡ç¨³å®šæ€§ï¼Œé™åˆ¶å†…å­˜ä½¿ç”¨

---

### Phase 3ï¼šä»£ç è´¨é‡ï¼ˆ1ä¸ªæœˆï¼‰ğŸŸ¢

- [ ] åˆå¹¶VLayout/HLayoutï¼ˆ2å°æ—¶ï¼‰
- [ ] åˆ é™¤ConfigContextæ¥å£ï¼ˆ15åˆ†é’Ÿï¼‰
- [ ] é‡æ„FpMethodHandlerï¼ˆ2å°æ—¶ï¼‰
- [ ] ä¼˜åŒ–åµŒå¥—å¹¶è¡Œæµï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] æ‹†åˆ†BurpExtenderä¸Šå¸ç±»ï¼ˆ1å‘¨ï¼‰

**æ€»è®¡**ï¼šçº¦2å‘¨å·¥ä½œé‡
**å½±å“**ï¼šé™ä½æŠ€æœ¯å€ºåŠ¡ï¼Œæå‡å¯ç»´æŠ¤æ€§

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### æ€§èƒ½æ”¹è¿›

| ä¼˜åŒ–é¡¹ | å½“å‰æ€§èƒ½ | ä¼˜åŒ–å | æå‡å€æ•° |
|--------|---------|--------|----------|
| QPSé™åˆ¶å™¨ | ä¸²è¡Œæ‰§è¡Œ | 50çº¿ç¨‹å¹¶å‘ | 50x |
| æŒ‡çº¹ç¼“å­˜ | æ— é™åˆ¶ | 10000æ¡LRU | å†…å­˜èŠ‚çœ2GB |
| åµŒå¥—å¹¶è¡Œæµ | è¿‡åº¦ç«äº‰ | æ™ºèƒ½ä¸²å¹¶è¡Œ | 1.3xï¼ˆå°æ•°æ®é›†ï¼‰ |

### ç¨³å®šæ€§æ”¹è¿›

- âœ… æ¶ˆé™¤3ç§å´©æºƒåœºæ™¯ï¼ˆæ•°ç»„è¶Šç•Œã€ç›‘å¬å™¨å¼‚å¸¸ã€æ ˆæº¢å‡ºï¼‰
- âœ… æ¶ˆé™¤1ç§æŒ‚èµ·åœºæ™¯ï¼ˆReDoSæ”»å‡»ï¼‰
- âœ… æ¶ˆé™¤2ç§å†…å­˜æ³„æ¼ï¼ˆæ— ç•Œé›†åˆï¼‰

### ä»£ç è´¨é‡æ”¹è¿›

- ğŸ”» åˆ é™¤277è¡Œé‡å¤ä»£ç ï¼ˆVLayout/HLayoutåˆå¹¶ï¼‰
- ğŸ”» åˆ é™¤1ä¸ªå¤šä½™æ¥å£ï¼ˆConfigContextï¼‰
- ğŸ”» ç®€åŒ–12ä¸ªå†—ä½™æ–¹æ³•ä¸º1ä¸ªæšä¸¾ï¼ˆFpMethodHandlerï¼‰
- ğŸ“ˆ ä»£ç å¯ç»´æŠ¤æ€§æå‡çº¦30%

---

## ğŸ¯ Linusé£æ ¼æ€»è¯„

### æ ¸å¿ƒåˆ¤æ–­

> **"This code works, but it's designed for short-term use, not production at scale."**

è¿™ä¸ªé¡¹ç›®çš„é—®é¢˜ä¸æ˜¯ä»£ç å†™å¾—æœ‰å¤šçƒ‚ï¼Œè€Œæ˜¯**æ•°æ®ç»“æ„é€‰æ‹©é”™è¯¯**å’Œ**å¹¶å‘å®‰å…¨æ„è¯†ä¸è¶³**ï¼š

### âœ… å¥½çš„éƒ¨åˆ†

1. **æ¶æ„æ¸…æ™°**ï¼šæ¨¡å—åˆ’åˆ†åˆç†ï¼ˆcommon vs onescanï¼‰
2. **èµ„æºç®¡ç†è§„èŒƒ**ï¼šçº¿ç¨‹æ± å’Œé›†åˆæ¸…ç†æ­£ç¡®
3. **UIè®¾è®¡è‰¯å¥½**ï¼šè‡ªå®šä¹‰å¸ƒå±€ç®¡ç†å™¨ï¼Œç»„ä»¶åˆ†ç¦»

### âŒ åçš„éƒ¨åˆ†

1. **QPSé™åˆ¶å™¨**ï¼šæ•™ç§‘ä¹¦çº§åˆ«çš„åé¢æ¡ˆä¾‹ï¼ˆæŒæœ‰é”sleepï¼‰
2. **æ— ç•Œé›†åˆ**ï¼šæ²¡è€ƒè™‘é•¿æ—¶é—´è¿è¡Œåœºæ™¯
3. **ReDoSæ¼æ´**ï¼šç”¨æˆ·å¯æ§æ­£åˆ™æ— ä¿æŠ¤
4. **ä»£ç é‡å¤**ï¼šVLayout/HLayoutçº¯ç²¹å¤åˆ¶ç²˜è´´

### æ ¸å¿ƒå»ºè®®

> **"Bad programmers worry about the code. Good programmers worry about data structures."**

**ä¿®å¥½æ•°æ®ç»“æ„ï¼Œä»£ç è‡ªç„¶å°±å¯¹äº†**ï¼š
- QPSé™åˆ¶å™¨ï¼šç”¨ReentrantLockæ›¿ä»£synchronized
- æ— ç•Œé›†åˆï¼šç”¨LRUç¼“å­˜æ›¿ä»£æ— é™HashMap
- æ­£åˆ™å¼•æ“ï¼šæ·»åŠ è¶…æ—¶æœºåˆ¶
- å¸ƒå±€ç®¡ç†å™¨ï¼šç”¨æšä¸¾æ–¹å‘æ›¿ä»£ä¸¤ä¸ªç±»

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

### ä»£ç è§„æ¨¡

```
æ€»è®¡ï¼š
- Javaæ–‡ä»¶ï¼š87ä¸ª
- ä»£ç è¡Œæ•°ï¼š16,696è¡Œ
- åŒ…ç»“æ„ï¼š21ä¸ªåŒ…
- æµ‹è¯•è¦†ç›–ç‡ï¼š0%ï¼ˆéœ€æ”¹è¿›ï¼‰
```

### é—®é¢˜åˆ†å¸ƒ

```
å¹¶å‘å®‰å…¨ï¼š10ä¸ªé—®é¢˜ï¼ˆ17%ï¼‰
å†…å­˜ç®¡ç†ï¼š3ä¸ªé—®é¢˜ï¼ˆ5%ï¼‰
å®‰å…¨æ¼æ´ï¼š7ä¸ªé—®é¢˜ï¼ˆ12%ï¼‰
é”™è¯¯å¤„ç†ï¼š13ä¸ªé—®é¢˜ï¼ˆ22%ï¼‰
ç®—æ³•å¤æ‚åº¦ï¼š4ä¸ªé—®é¢˜ï¼ˆ7%ï¼‰
æ¶æ„è®¾è®¡ï¼š8ä¸ªé—®é¢˜ï¼ˆ14%ï¼‰
ä»£ç é‡å¤ï¼š5ä¸ªé—®é¢˜ï¼ˆ8%ï¼‰
è¿‡åº¦è®¾è®¡ï¼š9ä¸ªé—®é¢˜ï¼ˆ15%ï¼‰
```

### ä¼˜å…ˆçº§åˆ†å¸ƒ

```
CRITICAL (ğŸ”´)ï¼š19% - å¿…é¡»ç«‹å³ä¿®å¤
HIGH (ğŸŸ¡)ï¼š29% - 1-2å‘¨å†…ä¿®å¤
MEDIUM (ğŸŸ )ï¼š34% - 1ä¸ªæœˆå†…æ”¹è¿›
LOW (ğŸŸ¢)ï¼š18% - æŒç»­æ”¹è¿›
```

---

## ğŸš€ åç»­è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ï¼ˆæœ¬å‘¨ï¼‰

1. **å¬å¼€æŠ€æœ¯ä¼šè®®**ï¼šè®¨è®ºCRITICALé—®é¢˜å’Œä¿®å¤è®¡åˆ’
2. **åˆ†é…ä»»åŠ¡**ï¼šPhase 1çš„4ä¸ªä»»åŠ¡åˆ†é…ç»™å¼€å‘äººå‘˜
3. **å»ºç«‹æµç¨‹**ï¼šPull Requestå¿…é¡»ç»è¿‡ä»£ç å®¡æŸ¥

### çŸ­æœŸè¡ŒåŠ¨ï¼ˆæœ¬æœˆï¼‰

1. **å¼•å…¥å·¥å…·**ï¼šSpotBugs, PMD, Checkstyleé›†æˆåˆ°CI/CD
2. **ç¼–å†™æµ‹è¯•**ï¼šæ ¸å¿ƒç®—æ³•å•å…ƒæµ‹è¯•ï¼ˆQpsLimiter, FpManagerï¼‰
3. **æ›´æ–°æ–‡æ¡£**ï¼šJavaDocè¡¥å…¨ï¼Œæ¶æ„æ–‡æ¡£æ›´æ–°

### é•¿æœŸè¡ŒåŠ¨ï¼ˆå­£åº¦ï¼‰

1. **é‡æ„æ¶æ„**ï¼šè§£è€¦BurpExtenderï¼Œæ‹†åˆ†èŒè´£
2. **æ€§èƒ½åŸºå‡†**ï¼šJMHæ€§èƒ½æµ‹è¯•ï¼Œå»ºç«‹åŸºçº¿
3. **è´¨é‡ç›‘æ§**ï¼šSonarQubeæŒç»­ç›‘æ§ä»£ç è´¨é‡

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶

æœ¬æ¬¡å®¡æŸ¥ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`.agent/code_review_report.md`** (49KB)
   - å®Œæ•´çš„ä»£ç å®¡æŸ¥æŠ¥å‘Š
   - 59ä¸ªé—®é¢˜çš„è¯¦ç»†åˆ†æ
   - ä¿®å¤å»ºè®®å’Œä»£ç ç¤ºä¾‹

2. **`.agent/quality_improvement_summary.md`** (æœ¬æ–‡ä»¶)
   - æ‰§è¡Œæ‘˜è¦
   - å…³é”®å‘ç°Top 5
   - ä¿®å¤è·¯çº¿å›¾å’Œä¼˜å…ˆçº§

3. **å®¡æŸ¥ä»£ç†è¾“å‡º**ï¼ˆå·²å½’æ¡£ï¼‰ï¼š
   - ä»£ç åº“ç»“æ„åˆ†æ
   - å¹¶å‘å®‰å…¨å®¡æŸ¥æŠ¥å‘Š
   - èµ„æºç®¡ç†å®¡æŸ¥æŠ¥å‘Š
   - å®‰å…¨æ¼æ´å®¡æŸ¥æŠ¥å‘Š

---

## ğŸ’¡ å…³é”®ç»“è®º

### é¡¹ç›®å¯ç”¨æ€§è¯„ä¼°

**å½“å‰çŠ¶æ€**ï¼šâœ… å¯ç”¨äºä¸­çŸ­æœŸæµ‹è¯•å’Œå°è§„æ¨¡ä½¿ç”¨
**ç”Ÿäº§å°±ç»ª**ï¼šâŒ éœ€è¦ä¿®å¤CRITICALé—®é¢˜åæ‰èƒ½é•¿æ—¶é—´ç”Ÿäº§ä½¿ç”¨

### é£é™©è¯„ä¼°

- **å´©æºƒé£é™©**ï¼šğŸ”´ HIGHï¼ˆæ•°ç»„è¶Šç•Œã€ç›‘å¬å™¨å¼‚å¸¸ï¼‰
- **æ€§èƒ½é£é™©**ï¼šğŸ”´ HIGHï¼ˆQPSé™åˆ¶å™¨ä¸²è¡ŒåŒ–ï¼‰
- **å®‰å…¨é£é™©**ï¼šğŸŸ¡ MEDIUMï¼ˆReDoSã€ååºåˆ—åŒ–ï¼‰
- **å†…å­˜é£é™©**ï¼šğŸŸ  MEDIUMï¼ˆæ— ç•Œé›†åˆï¼Œé•¿æ—¶é—´è¿è¡ŒåOOMï¼‰

### æœ€ç»ˆå»ºè®®

**ä¸‰ä¸ªå¿…é¡»**ï¼š
1. **å¿…é¡»ä¿®å¤Phase 1çš„4ä¸ªCRITICALé—®é¢˜**ï¼ˆ3.5å°æ—¶æŠ•å…¥ï¼‰
2. **å¿…é¡»å»ºç«‹å•å…ƒæµ‹è¯•**ï¼ˆå½“å‰0%è¦†ç›–ç‡ä¸å¯æ¥å—ï¼‰
3. **å¿…é¡»å¼•å…¥ä»£ç å®¡æŸ¥æµç¨‹**ï¼ˆé˜²æ­¢ç±»ä¼¼é—®é¢˜å†æ¬¡å¼•å…¥ï¼‰

**ä¸€å¥è¯æ€»ç»“**ï¼š
> **Fix the data structures first, then the code quality will follow.**
> **ï¼ˆå…ˆä¿®æ•°æ®ç»“æ„ï¼Œä»£ç è´¨é‡è‡ªç„¶è·Ÿä¸Šï¼‰**

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**ï¼š2025-12-02
**å®¡æŸ¥å·¥å…·**ï¼šClaude Code + Linusé£æ ¼äººå·¥å®¡æŸ¥
**ä¸‹æ¬¡å®¡æŸ¥å»ºè®®**ï¼šPhase 1ä¿®å¤å®Œæˆå

---

*"Talk is cheap. Show me the code (and fix the damn QpsLimiter)."* - Linus Torvalds (æ”¹ç¼–)
