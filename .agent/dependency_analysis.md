# OneScan é¡¹ç›® - API è¿ç§»ä¾èµ–å…³ç³»åˆ†æ

**åˆ†ææ—¥æœŸ:** 2025-12-06
**é¡¹ç›®:** OneScan
**ç›®æ ‡:** ä¸º Burp API è¿ç§»åˆ¶å®šå®‰å…¨ã€å¯æ‰§è¡Œçš„é¡ºåº

---

## æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£åŸºäº `.agent/api_usage_report.md` å’Œ `.agent/api_mapping.md` çš„åˆ†æç»“æœ,æ˜ç¡®å„æ¨¡å—é—´çš„ API ä¾èµ–å…³ç³»,ç¡®å®šè¿ç§»çš„ä¼˜å…ˆçº§å’Œé¡ºåº,è¯†åˆ«å¯èƒ½çš„é£é™©ç‚¹ã€‚

**æ ¸å¿ƒç»“è®º:**
- **è¿ç§»ç­–ç•¥:** ä¸‰å±‚æ¸è¿›å¼è¿ç§»(åŸºç¡€è®¾æ–½ â†’ ç‹¬ç«‹æ¨¡å— â†’ æ ¸å¿ƒé€»è¾‘)
- **å…³é”®çº¦æŸ:** æ¯ä¸ªé˜¶æ®µå®Œæˆåå¿…é¡»èƒ½ç¼–è¯‘ã€èƒ½è¿è¡Œ
- **æœ€å¤§é£é™©:** BurpExtender ä¸»ç±»æ˜¯å•ç‚¹ä¾èµ–,æ‰€æœ‰æ¨¡å—éƒ½ä¾èµ–å®ƒ
- **å¯å¹¶è¡Œä»»åŠ¡:** UI ç»„ä»¶å’Œå·¥å…·ç±»å¯åœ¨åŸºç¡€è®¾æ–½è¿ç§»å®Œæˆåå¹¶è¡Œå¤„ç†

---

## ä¸€ã€ä¾èµ–å…³ç³»åˆ†æçš„æ ¸å¿ƒåŸåˆ™

### 1.1 Linus çš„ä¸‰ä¸ªé—®é¢˜

åœ¨å¼€å§‹åˆ†æå‰,å…ˆå›ç­”æ ¸å¿ƒé—®é¢˜:

**1. è¿™æ˜¯ä¸ªçœŸé—®é¢˜è¿˜æ˜¯è‡†æƒ³å‡ºæ¥çš„?**
â†’ **çœŸé—®é¢˜**ã€‚å¦‚æœç›²ç›®è¿ç§»,ç¬¬ä¸€æ¬¡æäº¤å°±å¯èƒ½è®©é¡¹ç›®æ— æ³•ç¼–è¯‘ã€‚OneScan æœ‰ 2246 è¡Œæ ¸å¿ƒä»£ç ä¾èµ–ä¼ ç»Ÿ API,å¿…é¡»æœ‰åºè¿ç§»ã€‚

**2. æœ‰æ›´ç®€å•çš„æ–¹æ³•å—?**
â†’ **æœ‰**ã€‚ä¸å…¶ç”Ÿæˆå¤æ‚çš„ä¾èµ–å›¾è°±,ä¸å¦‚æŒ‰å¸¸è¯†å°†ä»»åŠ¡åˆ†æˆä¸‰å±‚:åŸºç¡€è®¾æ–½ â†’ ç‹¬ç«‹æ¨¡å— â†’ æ ¸å¿ƒé€»è¾‘ã€‚æ¯å±‚å†…éƒ¨å¯ä»¥å¹¶è¡Œ,å±‚ä¸å±‚ä¹‹é—´ä¸²è¡Œã€‚

**3. ä¼šç ´åä»€ä¹ˆå—?**
â†’ **å…³é”®çº¦æŸ**:æ¯æ¬¡æäº¤å `mvn compile` å¿…é¡»æˆåŠŸ,æ’ä»¶åŠ è½½ä¸èƒ½æŠ¥é”™ã€‚è¿™æ˜¯"Never break userspace"åŸåˆ™åœ¨è¿ç§»åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚

### 1.2 åˆ†æç›®æ ‡

ä¸æ˜¯ç”Ÿæˆ"ç†è®ºå®Œç¾"çš„æ‹“æ‰‘æ’åº,è€Œæ˜¯ç¡®ä¿:**æ¯ä¸€æ­¥æäº¤éƒ½èƒ½ç¼–è¯‘ã€éƒ½èƒ½è¿è¡Œ**ã€‚

---

## äºŒã€æ¨¡å—ä¾èµ–çŸ©é˜µ

### 2.1 æ ¸å¿ƒæ¨¡å—è¯†åˆ«

åŸºäºä»£ç ç»“æ„å’Œ API ä½¿ç”¨æŠ¥å‘Š,é¡¹ç›®ä¸»è¦æ¨¡å—å¦‚ä¸‹:

| æ¨¡å— | ä¸»è¦ç±» | ä¾èµ–çš„ä¼ ç»Ÿ API | è¢«ä¾èµ–æ¬¡æ•° | å…³é”®åº¦ |
|------|------|-------------|----------|--------|
| **å…¥å£å±‚** | BurpExtender.java | IBurpExtender, IBurpExtenderCallbacks | å…¨å±€ | â­â­â­â­â­ |
| **å·¥å…·å±‚** | common/utils/* | IExtensionHelpers | é«˜ | â­â­â­â­ |
| **UI å±‚** | onescan/ui/* | ITab, IMessageEditor | ä¸­ | â­â­â­ |
| **ä¿¡æ¯æ ‡ç­¾** | OneScanInfoTab | IMessageEditorTab | ä½ | â­â­â­ |
| **HTTP å¤„ç†** | BurpExtender (doScan æ–¹æ³•) | IProxyListener, IHttpRequestResponse | é«˜ | â­â­â­â­ |
| **èœå•** | BurpExtender (createMenuItems æ–¹æ³•) | IContextMenuFactory | ä½ | â­â­ |
| **çŠ¶æ€ç®¡ç†** | BurpExtender (extensionUnloaded æ–¹æ³•) | IExtensionStateListener | ä½ | â­â­ |

### 2.2 ä¾èµ–å…³ç³»å›¾(ç®€åŒ–ç‰ˆ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 0: åŸºç¡€è®¾æ–½å±‚ (Infrastructure)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ BurpExtender (ä¸»ç±»)                  â”‚     â”‚
â”‚  â”‚ - IBurpExtender â†’ BurpExtension     â”‚     â”‚
â”‚  â”‚ - IBurpExtenderCallbacks â†’ MontoyaApiâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â†“ æä¾› MontoyaApi å®ä¾‹              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: ç‹¬ç«‹æ¨¡å—å±‚ (Independent)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ UI ç»„ä»¶          â”‚  â”‚ å·¥å…·ç±»            â”‚   â”‚
â”‚  â”‚ - ITab          â”‚  â”‚ - IExtensionHelpersâ”‚  â”‚
â”‚  â”‚ - IMessageEditorâ”‚  â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ä¸Šä¸‹æ–‡èœå•       â”‚  â”‚ æ—¥å¿—è¾“å‡º          â”‚   â”‚
â”‚  â”‚ - IContextMenu  â”‚  â”‚ - stdout/stderr  â”‚   â”‚
â”‚  â”‚   Factory       â”‚  â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: æ ¸å¿ƒé€»è¾‘å±‚ (Core Logic)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ HTTP å¤„ç† (doScan æ ¸å¿ƒé€»è¾‘)          â”‚     â”‚
â”‚  â”‚ - IProxyListener                    â”‚     â”‚
â”‚  â”‚ - IHttpRequestResponse              â”‚     â”‚
â”‚  â”‚ - IRequestInfo / IResponseInfo      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ æ¶ˆæ¯ç¼–è¾‘å™¨ (OneScanInfoTab)          â”‚     â”‚
â”‚  â”‚ - IMessageEditorTab                 â”‚     â”‚
â”‚  â”‚ - IMessageEditorTabFactory          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å…³é”®å‘ç°

1. **å•ç‚¹ä¾èµ–:** BurpExtender æ˜¯æ‰€æœ‰æ¨¡å—çš„æ ¹,å¿…é¡»æœ€å…ˆè¿ç§»
2. **ä½è€¦åˆæ¨¡å—:** UI ç»„ä»¶ã€å·¥å…·ç±»ã€èœå•ç›¸å¯¹ç‹¬ç«‹,å¯å¹¶è¡Œè¿ç§»
3. **é«˜è€¦åˆæ¨¡å—:** HTTP å¤„ç†é€»è¾‘ä¾èµ–å¤šä¸ªæ¥å£,å¿…é¡»ä¸²è¡Œè¿ç§»
4. **ç‰¹æ®Šæƒ…å†µ:** OneScanInfoTab ä¾èµ– IExtensionHelpers,éœ€è¦åœ¨å·¥å…·ç±»è¿ç§»åå¤„ç†

---

## ä¸‰ã€è¿ç§»åˆ†å±‚æ¶æ„

### Layer 0: åŸºç¡€è®¾æ–½å±‚ (Infrastructure)

**ç›®æ ‡:** å»ºç«‹ Montoya API çš„åŸºç¡€,ä¸ºæ‰€æœ‰å…¶ä»–æ¨¡å—æä¾› `MontoyaApi` å®ä¾‹

**ä»»åŠ¡åˆ—è¡¨:**
- [MIGRATE-101] BurpExtender ç±»è¿ç§»
- [MIGRATE-102] æ‰©å±•ä¸Šä¸‹æ–‡è¿ç§»

**å…³é”®æ“ä½œ:**
```java
// è¿ç§»å‰
public class BurpExtender implements IBurpExtender {
    private IBurpExtenderCallbacks callbacks;

    @Override
    public void registerExtenderCallbacks(IBurpExtenderCallbacks callbacks) {
        this.callbacks = callbacks;
        // åˆå§‹åŒ–...
    }
}

// è¿ç§»å
public class BurpExtender implements BurpExtension {
    private MontoyaApi api;

    @Override
    public void initialize(MontoyaApi api) {
        this.api = api;
        // åˆå§‹åŒ–...
    }
}
```

**è¿ç§»éš¾åº¦:** ğŸŸ¡ Medium
**é¢„è®¡æ—¶é—´:** 8 å°æ—¶
**ä¾èµ–:** æ— 
**éªŒè¯æ ‡å‡†:** `mvn compile` æˆåŠŸ + æ’ä»¶èƒ½åŠ è½½

---

### Layer 1: ç‹¬ç«‹æ¨¡å—å±‚ (Independent Modules)

**ç›®æ ‡:** è¿ç§»ç›¸å¯¹ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—,è¿™äº›æ¨¡å—ä¹‹é—´æ²¡æœ‰å¼ºä¾èµ–

**å¯å¹¶è¡Œä»»åŠ¡:**

#### 1.1 UI ç»„ä»¶ (MIGRATE-301)
```java
// è¿ç§»å‰: å®ç° ITab æ¥å£
public class BurpExtender implements ITab {
    @Override
    public String getTabCaption() { return "OneScan"; }
    @Override
    public Component getUiComponent() { return mainPanel; }
}
callbacks.addSuiteTab(this);

// è¿ç§»å: ç›´æ¥æ³¨å†Œ
api.userInterface().registerSuiteTab("OneScan", mainPanel);
```
- **éš¾åº¦:** ğŸŸ¢ Low
- **æ—¶é—´:** 6 å°æ—¶
- **ä¾èµ–:** MIGRATE-102

#### 1.2 å·¥å…·ç±»è¿ç§» (MIGRATE-401)
```java
// è¿ç§»å‰
IExtensionHelpers helpers = callbacks.getHelpers();
IRequestInfo requestInfo = helpers.analyzeRequest(request);

// è¿ç§»å
HttpRequest httpRequest = HttpRequest.httpRequest(ByteArray.byteArray(request));
String method = httpRequest.method();
```
- **éš¾åº¦:** ğŸŸ¡ Medium
- **æ—¶é—´:** 6 å°æ—¶
- **ä¾èµ–:** MIGRATE-102

#### 1.3 ä¸Šä¸‹æ–‡èœå• (MIGRATE-302)
```java
// è¿ç§»å‰
public class BurpExtender implements IContextMenuFactory {
    @Override
    public List<JMenuItem> createMenuItems(IContextMenuInvocation invocation) {
        // ...
    }
}

// è¿ç§»å
public class MyContextMenuProvider implements ContextMenuItemsProvider {
    @Override
    public List<Component> provideMenuItems(ContextMenuEvent event) {
        // ...
    }
}
api.userInterface().registerContextMenuItemsProvider(new MyContextMenuProvider());
```
- **éš¾åº¦:** ğŸŸ¡ Medium
- **æ—¶é—´:** 6 å°æ—¶
- **ä¾èµ–:** MIGRATE-301

#### 1.4 æ—¥å¿—è¾“å‡º (MIGRATE-403)
```java
// è¿ç§»å‰
PrintWriter stdout = new PrintWriter(callbacks.getStdout(), true);
stdout.println("OneScan loaded");

// è¿ç§»å
api.logging().logToOutput("OneScan loaded");
```
- **éš¾åº¦:** ğŸŸ¢ Low
- **æ—¶é—´:** 2 å°æ—¶
- **ä¾èµ–:** MIGRATE-102

**Layer 1 æ€»æ—¶é—´:** 20 å°æ—¶ (å¦‚æœå¹¶è¡Œæ‰§è¡Œ,å®é™…è€—æ—¶ 6-8 å°æ—¶)

---

### Layer 2: æ ¸å¿ƒé€»è¾‘å±‚ (Core Logic)

**ç›®æ ‡:** è¿ç§»æ ¸å¿ƒä¸šåŠ¡é€»è¾‘,è¿™äº›æ¨¡å—ä¾èµ–å‰ä¸¤å±‚çš„æˆæœ

**å¿…é¡»ä¸²è¡Œä»»åŠ¡:**

#### 2.1 HTTP ç›‘å¬å™¨ (MIGRATE-201)
```java
// è¿ç§»å‰
public class BurpExtender implements IProxyListener {
    @Override
    public void processProxyMessage(boolean messageIsRequest,
                                    IInterceptedProxyMessage message) {
        if (!messageIsRequest) {
            doScan(message.getMessageInfo());
        }
    }
}

// è¿ç§»å
public class MyProxyResponseHandler implements ProxyResponseHandler {
    @Override
    public ProxyResponseReceivedAction handleResponseReceived(
            InterceptedResponse interceptedResponse) {
        doScan(interceptedResponse.messageReference());
        return ProxyResponseReceivedAction.continueWith(
            interceptedResponse.response());
    }

    @Override
    public ProxyResponseToBeSentAction handleResponseToBeSent(
            InterceptedResponse interceptedResponse) {
        return ProxyResponseToBeSentAction.continueWith(
            interceptedResponse.response());
    }
}
```
- **éš¾åº¦:** ğŸŸ¡ Medium
- **æ—¶é—´:** 6 å°æ—¶
- **ä¾èµ–:** MIGRATE-102

#### 2.2 HTTP æ¶ˆæ¯å¤„ç† (MIGRATE-202)
```java
// è¿ç§»å‰
IHttpRequestResponse requestResponse = ...;
byte[] request = requestResponse.getRequest();
byte[] response = requestResponse.getResponse();

// è¿ç§»å
HttpRequestResponse requestResponse = ...;
HttpRequest request = requestResponse.request();
HttpResponse response = requestResponse.response();
```
- **éš¾åº¦:** ğŸŸ¡ Medium
- **æ—¶é—´:** 6 å°æ—¶
- **ä¾èµ–:** MIGRATE-201

#### 2.3 æ¶ˆæ¯ç¼–è¾‘å™¨ (MIGRATE-303)
```java
// è¿ç§»å‰
public class OneScanInfoTab implements IMessageEditorTab {
    @Override
    public void setMessage(byte[] content, boolean isRequest) {
        // ...
    }
}

// è¿ç§»å
public class OneScanInfoEditor implements ExtensionProvidedHttpResponseEditor {
    @Override
    public void setRequestResponse(HttpRequestResponse requestResponse) {
        // ...
    }
}
```
- **éš¾åº¦:** ğŸ”´ High
- **æ—¶é—´:** 8 å°æ—¶
- **ä¾èµ–:** MIGRATE-302 + MIGRATE-401

**Layer 2 æ€»æ—¶é—´:** 20 å°æ—¶ (å¿…é¡»ä¸²è¡Œæ‰§è¡Œ)

---

## å››ã€è¿ç§»é¡ºåºå’Œä¼˜å…ˆçº§

### 4.1 æ¨èè¿ç§»è·¯å¾„

```
é˜¶æ®µ 0: API åˆ†æ (å·²å®Œæˆ)
  âœ… MIGRATE-001: æ‰«æ API ä½¿ç”¨
  âœ… MIGRATE-002: API æ˜ å°„åˆ†æ
  âœ… MIGRATE-003: ä¾èµ–å…³ç³»åˆ†æ
  â³ MIGRATE-004: ç”Ÿæˆè¿ç§»è®¡åˆ’

é˜¶æ®µ 1: åŸºç¡€è®¾æ–½å±‚ (ä¸²è¡Œ,8 å°æ—¶)
  â†’ MIGRATE-101: BurpExtender ç±»è¿ç§»
  â†’ MIGRATE-102: æ‰©å±•ä¸Šä¸‹æ–‡è¿ç§»
  éªŒè¯: mvn compile + æ’ä»¶åŠ è½½æˆåŠŸ

é˜¶æ®µ 2: ç‹¬ç«‹æ¨¡å—å±‚ (å¯å¹¶è¡Œ,6-8 å°æ—¶)
  â”Œâ†’ MIGRATE-301: UI æ ‡ç­¾é¡µè¿ç§» (6h)
  â”œâ†’ MIGRATE-401: å·¥å…·ç±»è¿ç§» (6h)
  â”œâ†’ MIGRATE-403: æ—¥å¿—è¾“å‡ºè¿ç§» (2h)
  â””â†’ MIGRATE-302: ä¸Šä¸‹æ–‡èœå•è¿ç§» (6h, ä¾èµ– 301)
  éªŒè¯: æ‰€æœ‰ UI åŠŸèƒ½æ­£å¸¸

é˜¶æ®µ 3: æ ¸å¿ƒé€»è¾‘å±‚ (ä¸²è¡Œ,20 å°æ—¶)
  â†’ MIGRATE-201: HTTP ç›‘å¬å™¨è¿ç§» (6h)
  â†’ MIGRATE-202: HTTP æ¶ˆæ¯å¤„ç† (6h)
  â†’ MIGRATE-303: æ¶ˆæ¯ç¼–è¾‘å™¨è¿ç§» (8h)
  éªŒè¯: æ ¸å¿ƒæ‰«æåŠŸèƒ½æ­£å¸¸

é˜¶æ®µ 4: æ¸…ç†å’Œæµ‹è¯• (6-12 å°æ—¶)
  â†’ MIGRATE-501: åŠŸèƒ½æµ‹è¯•
  â†’ MIGRATE-502: å…¼å®¹æ€§æµ‹è¯•
  â†’ MIGRATE-503: æ¸…ç†ä¼ ç»Ÿ API ä¾èµ–
```

### 4.2 å…³é”®é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | å®Œæˆæ ‡å¿— | éªŒè¯æ–¹å¼ |
|-------|---------|---------|
| åŸºç¡€è®¾æ–½å°±ç»ª | MIGRATE-102 å®Œæˆ | `mvn compile` + æ’ä»¶åŠ è½½ |
| UI å±‚å¯ç”¨ | MIGRATE-302 å®Œæˆ | æ ‡ç­¾é¡µæ˜¾ç¤º + èœå•å¯ç‚¹å‡» |
| æ ¸å¿ƒåŠŸèƒ½å°±ç»ª | MIGRATE-202 å®Œæˆ | doScan èƒ½æ­£å¸¸æ‰«æ |
| å…¨éƒ¨è¿ç§»å®Œæˆ | MIGRATE-503 å®Œæˆ | pom.xml ç§»é™¤ä¼ ç»Ÿ API ä¾èµ– |

---

## äº”ã€é£é™©è¯„ä¼°å’Œç¼“è§£æªæ–½

### 5.1 é«˜é£é™©ç‚¹

#### é£é™© 1: BurpExtender ä¸»ç±»è¿ç§»å¤±è´¥

**å½±å“:** å…¨å±€å´©æºƒ,æ‰€æœ‰åŠŸèƒ½ä¸å¯ç”¨

**æ¦‚ç‡:** ä½ (API æ˜ å°„æ¸…æ™°)

**ç¼“è§£æªæ–½:**
1. åœ¨ç‹¬ç«‹åˆ†æ”¯è¿›è¡Œè¿ç§»
2. ä¿ç•™åŸ `registerExtenderCallbacks()` æ–¹æ³•ä½“ä½œä¸ºå‚è€ƒ
3. é€æ­¥è¿ç§»,æ¯è¿ç§»ä¸€ä¸ª `callbacks.xxx()` è°ƒç”¨å°±æµ‹è¯•ä¸€æ¬¡

#### é£é™© 2: IExtensionHelpers å¯†é›†ä½¿ç”¨ (30+ å¤„)

**å½±å“:** å¤§é‡ä»£ç éœ€è¦ä¿®æ”¹,å®¹æ˜“é—æ¼

**æ¦‚ç‡:** ä¸­

**ç¼“è§£æªæ–½:**
1. ä½¿ç”¨ IDE çš„"Find Usages"åŠŸèƒ½æ‰¾åˆ°æ‰€æœ‰è°ƒç”¨ç‚¹
2. åˆ›å»ºä¸´æ—¶é€‚é…å™¨ç±»è¿‡æ¸¡(å¯é€‰)
3. ä½¿ç”¨å•å…ƒæµ‹è¯•è¦†ç›–å…³é”®å·¥å…·æ–¹æ³•

#### é£é™© 3: OneScanInfoTab æ¶æ„å˜åŒ–

**å½±å“:** æ¶ˆæ¯ç¼–è¾‘å™¨åŠŸèƒ½å¤±æ•ˆ

**æ¦‚ç‡:** ä¸­

**ç¼“è§£æªæ–½:**
1. ä¿æŒä¸šåŠ¡é€»è¾‘ä¸å˜,ä»…ä¿®æ”¹æ¥å£é€‚é…å±‚
2. å…ˆè¿ç§»ç®€å•çš„ `ITab` æ¥å£,ç§¯ç´¯ç»éªŒåå†å¤„ç†å¤æ‚çš„ `IMessageEditorTab`
3. å¯ä»¥å…ˆè·³è¿‡è¯¥ä»»åŠ¡,æœ€åå†å¤„ç†

### 5.2 ä¸­é£é™©ç‚¹

#### é£é™© 4: ä»£ç†ç›‘å¬å™¨æ‹†åˆ†

**å½±å“:** ä»£ç†æµé‡æ‹¦æˆªé€»è¾‘éœ€è¦é‡æ„

**æ¦‚ç‡:** ä½ (OneScan ä»…å¤„ç†å“åº”,é€»è¾‘ç®€å•)

**ç¼“è§£æªæ–½:**
1. OneScan ä»…å®ç° `ProxyResponseHandler`,ä¸éœ€è¦ `ProxyRequestHandler`
2. `processProxyMessage()` ä¸­çš„é€»è¾‘ç›´æ¥è¿ç§»åˆ° `handleResponseReceived()`

#### é£é™© 5: ä¸å¯å˜å¯¹è±¡é€‚åº”

**å½±å“:** ä¿®æ”¹ HTTP æ¶ˆæ¯çš„ä»£ç éœ€è¦é‡å†™

**æ¦‚ç‡:** ä½ (OneScan ä¸»è¦è¯»å–æ¶ˆæ¯,è¾ƒå°‘ä¿®æ”¹)

**ç¼“è§£æªæ–½:**
1. ä½¿ç”¨ `HttpRequest.withHeader()` ç­‰ Builder æ–¹æ³•
2. é¿å…ç›´æ¥æ“ä½œå­—èŠ‚æ•°ç»„

### 5.3 ä½é£é™©ç‚¹

- UI æ ‡ç­¾é¡µè¿ç§»: API ç®€åŒ–,é£é™©ä½
- æ—¥å¿—è¾“å‡ºè¿ç§»: ç®€å•æ›¿æ¢,é£é™©ä½
- ä¸Šä¸‹æ–‡èœå•è¿ç§»: API ç›¸ä¼¼,é£é™©ä½

---

## å…­ã€è·¨å±‚ä¾èµ–è¯†åˆ«

### 6.1 ä¾èµ–å†²çªæ£€æµ‹

**æ£€æµ‹ç»“æœ:** âœ… æ— å¾ªç¯ä¾èµ–

**éªŒè¯:**
- Layer 0 ä¸ä¾èµ–ä»»ä½•å±‚
- Layer 1 ä»…ä¾èµ– Layer 0
- Layer 2 ä»…ä¾èµ– Layer 0 å’Œ Layer 1

### 6.2 ç‰¹æ®Šä¾èµ–å…³ç³»

| ä»»åŠ¡ | ä¾èµ–çš„å…¶ä»–ä»»åŠ¡ | åŸå›  |
|-----|-------------|------|
| MIGRATE-303 | MIGRATE-302 + MIGRATE-401 | OneScanInfoTab éœ€è¦ IExtensionHelpers è¿ç§»å®Œæˆ |
| MIGRATE-202 | MIGRATE-201 | HTTP æ¶ˆæ¯å¤„ç†ä¾èµ–ç›‘å¬å™¨åŸºç¡€ |
| æ‰€æœ‰ Layer 1 ä»»åŠ¡ | MIGRATE-102 | éœ€è¦ MontoyaApi å®ä¾‹ |
| æ‰€æœ‰ Layer 2 ä»»åŠ¡ | MIGRATE-102 | éœ€è¦ MontoyaApi å®ä¾‹ |

### 6.3 å¯å®‰å…¨å¹¶è¡Œçš„ä»»åŠ¡ç»„

**ç»„ 1 (Layer 1 å¹¶è¡Œç»„):**
- MIGRATE-301 (UI æ ‡ç­¾é¡µ)
- MIGRATE-401 (å·¥å…·ç±»)
- MIGRATE-403 (æ—¥å¿—è¾“å‡º)

**æ³¨æ„:** MIGRATE-302 (ä¸Šä¸‹æ–‡èœå•) ä¾èµ– MIGRATE-301,éœ€è¦ç¨åæ‰§è¡Œ

---

## ä¸ƒã€ç¼–è¯‘éªŒè¯ç­–ç•¥

### 7.1 æ¯å±‚è¿ç§»åçš„éªŒè¯æ¸…å•

**Layer 0 éªŒè¯:**
```bash
# 1. ç¼–è¯‘æ£€æŸ¥
mvn clean compile

# 2. æ’ä»¶åŠ è½½æ£€æŸ¥
java -jar burpsuite_pro.jar
# æ‰‹åŠ¨åŠ è½½æ’ä»¶,æŸ¥çœ‹æ˜¯å¦æŠ¥é”™

# 3. åŸºç¡€åŠŸèƒ½æ£€æŸ¥
- æ’ä»¶åç§°æ˜¾ç¤ºæ­£ç¡®
- æ‰©å±•å¸è½½å¤„ç†å™¨æ³¨å†ŒæˆåŠŸ
```

**Layer 1 éªŒè¯:**
```bash
# 1. ç¼–è¯‘æ£€æŸ¥
mvn clean compile

# 2. UI åŠŸèƒ½æ£€æŸ¥
- "OneScan" æ ‡ç­¾é¡µæ˜¾ç¤º
- å³é”®èœå•"å‘é€åˆ°æ’ä»¶"å‡ºç°
- æ§åˆ¶å°æ—¥å¿—æ­£å¸¸è¾“å‡º

# 3. å·¥å…·ç±»æ£€æŸ¥
- HTTP è¯·æ±‚è§£ææ­£å¸¸
- å­—ç¬¦ä¸²/å­—èŠ‚æ•°ç»„è½¬æ¢æ­£å¸¸
```

**Layer 2 éªŒè¯:**
```bash
# 1. ç¼–è¯‘æ£€æŸ¥
mvn clean compile

# 2. æ ¸å¿ƒåŠŸèƒ½æ£€æŸ¥
- ä»£ç†ç›‘å¬å™¨æ•è·æµé‡
- doScan æ–¹æ³•æ­£å¸¸æ‰§è¡Œ
- OneScan Info æ ‡ç­¾é¡µæ˜¾ç¤ºå†…å®¹

# 3. é›†æˆæµ‹è¯•
- ä½¿ç”¨çœŸå®æµé‡æµ‹è¯•æ‰«æåŠŸèƒ½
- éªŒè¯ä¸ Repeater çš„é›†æˆ
```

### 7.2 å›æ»šç­–ç•¥

å¦‚æœæŸå±‚è¿ç§»å¤±è´¥:

1. **Git åˆ†æ”¯ç­–ç•¥:**
   - æ¯å±‚è¿ç§»åœ¨ç‹¬ç«‹åˆ†æ”¯è¿›è¡Œ
   - åˆå¹¶å‰å¿…é¡»é€šè¿‡éªŒè¯
   - å¤±è´¥æ—¶å›æ»šåˆ°å‰ä¸€å±‚çš„ç¨³å®šåˆ†æ”¯

2. **æ¸è¿›å¼åˆå¹¶:**
   - Layer 0 â†’ `migrate-layer0` åˆ†æ”¯
   - Layer 1 â†’ `migrate-layer1` åˆ†æ”¯ (åŸºäº layer0)
   - Layer 2 â†’ `migrate-layer2` åˆ†æ”¯ (åŸºäº layer1)

---

## å…«ã€æ€§èƒ½å’Œå…¼å®¹æ€§è€ƒè™‘

### 8.1 æ€§èƒ½å½±å“

**é¢„æœŸæ”¹è¿›:**
- Montoya API ä½¿ç”¨å¼ºç±»å‹å¯¹è±¡,å‡å°‘å­—èŠ‚æ•°ç»„è½¬æ¢å¼€é”€
- ä¸å¯å˜å¯¹è±¡æ¨¡å¼å‡å°‘å¹¶å‘é—®é¢˜

**æ½œåœ¨é£é™©:**
- å¯¹è±¡åˆ›å»ºå¼€é”€å¢åŠ  (ä¸å¯å˜å¯¹è±¡éœ€è¦é¢‘ç¹åˆ›å»ºå‰¯æœ¬)

**ç¼“è§£æªæ–½:**
- é¿å…åœ¨å¾ªç¯ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡
- ä½¿ç”¨ Builder æ¨¡å¼æ‰¹é‡ä¿®æ”¹å±æ€§

### 8.2 Burp Suite ç‰ˆæœ¬å…¼å®¹æ€§

**Montoya API æœ€ä½è¦æ±‚:** Burp Suite 2023.1+

**OneScan å½“å‰æ”¯æŒ:** Burp Suite Professional/Community Edition

**è¿ç§»åæ”¯æŒ:**
- âœ… Burp Suite 2023.1+
- âŒ Burp Suite 2022.x åŠä»¥ä¸‹ (ä¼ ç»Ÿ API å·²å¼ƒç”¨)

**å»ºè®®:**
- åœ¨ pom.xml ä¸­æ˜ç¡®æ ‡æ³¨æœ€ä½ Burp ç‰ˆæœ¬è¦æ±‚
- åœ¨æ’ä»¶åŠ è½½æ—¶æ£€æŸ¥ Burp ç‰ˆæœ¬

---

## ä¹ã€æ€»ç»“å’Œå»ºè®®

### 9.1 å…³é”®å†³ç­–

1. **é‡‡ç”¨ä¸‰å±‚æ¶æ„**: åŸºç¡€è®¾æ–½ â†’ ç‹¬ç«‹æ¨¡å— â†’ æ ¸å¿ƒé€»è¾‘
2. **æ¸è¿›å¼è¿ç§»**: æ¯å±‚è¿ç§»åéƒ½èƒ½ç¼–è¯‘å’Œè¿è¡Œ
3. **å¹¶è¡Œä¼˜åŒ–**: Layer 1 çš„ 4 ä¸ªä»»åŠ¡ä¸­æœ‰ 3 ä¸ªå¯å¹¶è¡Œ
4. **é£é™©æ§åˆ¶**: åœ¨ç‹¬ç«‹åˆ†æ”¯æ“ä½œ,æ¯å±‚åˆå¹¶å‰éªŒè¯

### 9.2 é¢„è®¡æ—¶é—´è¡¨

| é˜¶æ®µ | æ—¶é—´ | å…³é”®äº§å‡º |
|-----|------|---------|
| é˜¶æ®µ 0 (åˆ†æ) | å·²å®Œæˆ | æœ¬æ–‡æ¡£ |
| é˜¶æ®µ 1 (åŸºç¡€è®¾æ–½) | 8 å°æ—¶ | MontoyaApi å°±ç»ª |
| é˜¶æ®µ 2 (ç‹¬ç«‹æ¨¡å—) | 6-8 å°æ—¶ | UI + å·¥å…·ç±»å°±ç»ª |
| é˜¶æ®µ 3 (æ ¸å¿ƒé€»è¾‘) | 20 å°æ—¶ | æ ¸å¿ƒåŠŸèƒ½å°±ç»ª |
| é˜¶æ®µ 4 (æµ‹è¯•æ¸…ç†) | 12 å°æ—¶ | è¿ç§»å®Œæˆ |
| **æ€»è®¡** | **46-48 å°æ—¶** | **å¯è¿è¡Œçš„ Montoya ç‰ˆæœ¬** |

### 9.3 æœ€ç»ˆå»ºè®®

**ä¼˜å…ˆçº§æ’åº:**
1. â­â­â­â­â­ MIGRATE-101/102 (åŸºç¡€è®¾æ–½,å¿…é¡»æœ€å…ˆ)
2. â­â­â­â­ MIGRATE-401 (å·¥å…·ç±»,å½±å“èŒƒå›´å¤§)
3. â­â­â­â­ MIGRATE-201/202 (HTTP å¤„ç†,æ ¸å¿ƒåŠŸèƒ½)
4. â­â­â­ MIGRATE-301/302 (UI ç»„ä»¶,ç”¨æˆ·ä½“éªŒ)
5. â­â­â­ MIGRATE-303 (æ¶ˆæ¯ç¼–è¾‘å™¨,å¤æ‚ä½†éå¿…éœ€)
6. â­â­ MIGRATE-403 (æ—¥å¿—è¾“å‡º,ç®€å•)

**å¯é€‰é™çº§ç­–ç•¥:**
- å¦‚æœæ—¶é—´ç´§å¼ ,MIGRATE-303 (OneScan Info æ ‡ç­¾é¡µ) å¯ä»¥æš‚æ—¶è·³è¿‡
- å¦‚æœé‡åˆ°æŠ€æœ¯éš¾é¢˜,å¯ä»¥å…ˆè¿ç§»å…¶ä»–ä»»åŠ¡,ç§¯ç´¯ç»éªŒåå†å›å¤´å¤„ç†

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨:**
1. ç”Ÿæˆè¯¦ç»†çš„è¿ç§»è®¡åˆ’ (MIGRATE-004)
2. åˆ›å»º Git åˆ†æ”¯: `migrate-layer0`
3. å¼€å§‹ MIGRATE-101: BurpExtender ç±»è¿ç§»

---

## é™„å½• A: ä¾èµ–çŸ©é˜µ (è¯¦ç»†ç‰ˆ)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | ä¾èµ–ä»»åŠ¡ | è¢«ä¾èµ–ä»»åŠ¡ | å¯å¹¶è¡Œä»»åŠ¡ |
|---------|---------|---------|-----------|-----------|
| MIGRATE-101 | BurpExtender ç±»è¿ç§» | æ—  | 102 | æ—  |
| MIGRATE-102 | æ‰©å±•ä¸Šä¸‹æ–‡è¿ç§» | 101 | 201, 301, 401, 403 | æ—  |
| MIGRATE-201 | HTTP ç›‘å¬å™¨è¿ç§» | 102 | 202 | 301, 401, 403 |
| MIGRATE-202 | HTTP æ¶ˆæ¯å¤„ç† | 201 | 203 | 301, 401, 403 |
| MIGRATE-203 | ä»£ç†ç›‘å¬å™¨è¿ç§» | 202 | æ—  | 301, 302, 303, 401, 403 |
| MIGRATE-301 | æ ‡ç­¾é¡µè¿ç§» | 102 | 302 | 201, 401, 403 |
| MIGRATE-302 | ä¸Šä¸‹æ–‡èœå•è¿ç§» | 301 | 303 | 201, 401, 403 |
| MIGRATE-303 | æ¶ˆæ¯ç¼–è¾‘å™¨è¿ç§» | 302, 401 | æ—  | 201, 403 |
| MIGRATE-401 | å·¥å…·ç±»è¿ç§» | 102 | 303, 402 | 201, 301, 403 |
| MIGRATE-402 | æ‰«æå™¨é›†æˆè¿ç§» | 401 | æ—  | 201, 301, 302, 303, 403 |
| MIGRATE-403 | æ—¥å¿—è¾“å‡ºè¿ç§» | 102 | æ—  | 201, 301, 401 |

---

## é™„å½• B: å¿«é€Ÿå†³ç­–æ ‘

```
å¼€å§‹è¿ç§»
   â†“
[Q] æ˜¯å¦å®Œæˆ MIGRATE-102?
   â”œâ”€ NO â†’ å…ˆå®Œæˆ MIGRATE-101 å’Œ MIGRATE-102
   â””â”€ YES â†“
         [Q] æƒ³ä¼˜å…ˆæ¢å¤å“ªä¸ªåŠŸèƒ½?
            â”œâ”€ UI åŠŸèƒ½ â†’ MIGRATE-301 â†’ MIGRATE-302 â†’ MIGRATE-303
            â”œâ”€ æ ¸å¿ƒæ‰«æ â†’ MIGRATE-201 â†’ MIGRATE-202 â†’ MIGRATE-203
            â””â”€ å·¥å…·æ–¹æ³• â†’ MIGRATE-401 â†’ MIGRATE-402
                  â†“
            [Q] æ‰€æœ‰åŠŸèƒ½éƒ½è¿ç§»å®Œæˆ?
               â”œâ”€ NO â†’ å›åˆ°ä¸Šä¸€æ­¥,ç»§ç»­è¿ç§»
               â””â”€ YES â†’ MIGRATE-501/502/503 (æµ‹è¯•å’Œæ¸…ç†)
```

---

**æ–‡æ¡£ç‰ˆæœ¬:** 1.0
**ä½œè€…:** Claude (AI Agent)
**ä¸‹ä¸€æ­¥:** ç”Ÿæˆ `.agent/migration_plan.md`
