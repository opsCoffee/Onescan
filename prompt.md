## 执行模式：CI/CD 自动化（无人值守）

**环境**：GitHub Actions，无用户交互，所有操作自动批准（`--dangerously-skip-permissions`）。

**退出检查**：如果 `.agent/completed` 文件存在，立即退出（防止重复执行）。

## TODO list:

请以深度思考模式，调用子代理和mcp来完成如下任务：

请对当前项目代码库进行全面的技术审查，重点分析以下方面：

1. **逻辑错误**：
   - 识别所有可能导致程序行为异常的逻辑缺陷
   - 对每个问题提供具体的代码位置（文件路径和行号）
   - 解释错误的潜在影响和复现条件
   - 分析边界条件处理（空值、空集合、边界值）

2. **冗余代码**：
   - 查找重复实现的功能模块
   - 识别可以合并或抽象为公共函数的相似代码段
   - 标记未使用的变量、函数和导入
   - 检测可以用设计模式简化的重复逻辑

3. **数据流分析**：
   - 追踪关键数据在系统中的流转路径（从输入到输出）
   - 识别数据转换和处理的各个阶段
   - 检查数据验证和清洗的完整性
   - 发现潜在的数据泄漏或污染点
   - 分析数据依赖关系和耦合度

4. **算法复杂度评估**：
   - 分析核心算法的时间复杂度（Big O）
   - 评估空间复杂度和内存使用模式
   - 识别可优化的嵌套循环和递归调用
   - 检测潜在的性能退化场景（如 O(n²) 可优化为 O(n)）
   - 标记大数据量下可能的性能瓶颈

5. **并发安全审查**：
   - 检查共享资源的访问控制（线程安全）
   - 识别潜在的竞态条件和死锁风险
   - 评估同步机制的正确性和效率
   - 检查线程池和异步任务的资源管理
   - 分析并发场景下的数据一致性保障

6. **架构设计审查**：
   - 评估模块间的耦合度和内聚性
   - 检查是否遵循 SOLID 原则
   - 识别违反单一职责的"上帝类"
   - 分析依赖注入和控制反转的使用
   - 评估接口设计的合理性和扩展性

7. **技术债务**：
   - 评估不符合项目代码规范的实现
   - 识别性能瓶颈和资源使用效率低下的区域
   - 发现缺乏适当错误处理的代码段
   - 标记测试覆盖率不足的关键功能
   - 检查资源泄漏（文件句柄、数据库连接、内存）

8. **修复方案**：
   - 为每个问题提供具体、可执行的修复建议
   - 按照优先级（高/中/低）对问题进行分类
   - 估计每个修复所需的工作量
   - 提供修复后的示例代码片段
   - 说明修复后的性能提升或风险降低程度

请以结构化报告的形式呈现分析结果，包含问题摘要、详细说明和修复建议三个部分。

**如果 TODO list 为空或选择暂停**：创建 `.agent/completed` 文件并退出。

## 执行规则:

### Workflow：
- 检查 `.agent/completed`，存在则退出
- TODO 为空：创建 `.agent/completed` 并退出
- TODO 非空：深度思考分析需求、设计数据结构、拆分任务
- 任务独立时并行执行，冲突时线性执行
- 每个任务完成后立即运行测试验证

### 工作规范：
- 使用 `.agent/` 存储计划和进度追踪
- 优先使用 mcp 和子代理处理独立任务
- 原子化变更，最小化修改范围
- 每个任务独立提交，便于问题定位和回滚
- CHANGELOG.md 遵循 Keep a Changelog 格式

### Git Commit 规范：
格式：`<type>(<scope>): <中文描述>`

类型：
- feat（新功能）
- fix（修复）
- docs（文档）
- refactor（重构）
- test（测试）
- chore（构建/工具）
- perf（性能优化）

**要求**：
- description 必须使用中文
- 禁止添加任何 AI 签名、footer 或 "Co-Authored-By"
- 描述要具体，说明改动内容和原因

示例：
- `refactor(logging): 合并emoji模块，减少文件碎片化`
- `chore(cleanup): 删除废弃的日志函数和未使用导入`
- `refactor(errors): 使用泛型trait消除错误处理函数重复`

### 测试验证：
每个任务完成后必须执行：
```bash
# 运行所有测试
mvn test

# 检查编译警告
mvn clean package

# 格式化检查
mvn clean compile dependency-check:check
```

### 完成后操作：
所有任务完成后：
1. 运行完整测试套件
2. 更新 `.agent/quality_improvement_summary.md` 添加本次执行结果
3. 执行 `git add . && git commit && git push`
4. 创建 `.agent/completed` 文件并退出

### 错误处理：
- 记录到 `.agent/errors.log`
- 如果测试失败，回滚变更并记录原因
- 继续下一任务，不要停止等待
- 如果连续3个任务失败，停止执行并报告

### 执行约束：
- 时间限制：6 小时
- 超时后提交已完成工作并退出
- 不要添加 TODO 外的任务
- 不要执行标记为"不执行"的高风险任务
